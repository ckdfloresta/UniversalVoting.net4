<!DOCTYPE html>
<html>
<head>
    <script src="scripts/jquery-3.2.1.min.js"></script>
    <title></title>
</head>
<!--EventJudgeID,ContestantID,EventCriteriaID for input and ouput, score for input only-->
<body onload="checksession()">
    <datalist id="tickmarks">
        <option value="1" />
        <option value="2" />
        <option value="3" />
        <option value="4" />
        <option value="5" />
        <option value="6" />
        <option value="7" />
        <option value="8" />
        <option value="9" />
        <option value="10" />
    </datalist>   

    <div>

        <button runat="server" onclick="goback()">Go back </button>
        <br/>
        <br />
    </div>
    
    <img id="mypic" src="images/girl.jpg" alt="default boy" height="200" width="200"/>
    <h2 id="contestantname">Lorem Ipsum Pogi</h2>

    <table id="mytable" style="width:100%" border="1">
        <thead>
            <tr>
                <th>Criteria</th>
                <th>Score( 0 to 10)</th>
            </tr>
        </thead>
        <tr id="tblrow1">
    </table>
    <script>
        //EventJudgeID, ContestantID, EventCriteriaID for input and ouput, score for input only

        function goback()
        {
            setTimeout(window.location.replace("home.html"));
        }

        function checksession() {     
            var conid = sessionStorage.getItem("contestantID");
            var ejid = sessionStorage.getItem("EventJudgeID");

            console.log("contestant id: " + conid);
            console.log("Event judge id :" + ejid)
            if (conid == null)
            {
                alert("You should not be here, redirecting..");
                setTimeout(window.location.replace("home.html"), 3000);
            }

            else {
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost/service.svc/MCspViewContestant',
                    data: { 'ContestantID': conid },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    processdata: true,
                    success: function (result) {

                        var myresult = JSON.parse(result.MCspViewContestantResult);
                        console.log("Contestant:");
                        console.log(myresult);
                        document.getElementById("contestantname").innerText = myresult[0].FirstName + " " + myresult[0].LastName + " #" + myresult[0].ContestantNumber;
                        document.getElementById("mypic").src = "images/" + myresult[0].PersonID + ".jpg";
                        document.getElementById("mypic").alt = "Person With personid="+myresult[0].PersonID + " picture should be here";
                    },
                    error: function (msg) {
                        alert('Error Contacting Server, please try again later.');
                    }
                });
                 
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost/service.svc/home_get_criteriawithscore',
                    data: { 'ejid': ejid, 'conid':conid },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    processdata: true,
                    success: function (result) {
                        var x = 0;
                        var myresult = JSON.parse(result.home_get_criteriawithscoreResult);
                        console.log("Result of eventjudgeID");
                        for (intctr in myresult) {
                            $('#mytable tbody').append('<tr id=tblrow' + intctr + '><th id=crit' + intctr + '>' + myresult[intctr].CriteriaName + '</th><th><input id="sr' + intctr + '" name="' + myresult[intctr].EventCriteriaID + '" type="range" min="0" step="1" max="10" list="tickmarks" value="' + myresult[intctr].Score + '" onchange="assignnumber(this,' + intctr + ')" class="input-transparent" /><h4 id="tv' + intctr + '">' + myresult[intctr].Score + '</h4></th></tr>');
                            x++
                        }  
                        
                        console.log("current score data obtained:");
                        console.log(myresult);
                },
                  error: function (msg) {
                        alert('Error Contacting Server, please try again later.');
                    }
                });


        };

        }

        function assignnumber(input, selectornumber) {
            
            var x = document.getElementById("sr" + selectornumber).value;
            var conid = sessionStorage.getItem("contestantID");
            var ejid = sessionStorage.getItem("EventJudgeID");
            document.getElementById("tv" + selectornumber).innerText = x;

           // console.log("On row:" + selectornumber);
            //console.log(input.name);
            //add score to person
            $.ajax({
                type: 'GET',
                url: 'http://localhost/service.svc/MCspUpdateScore',
                data: {
                    'EventJudgeID': ejid,
                    'ContestantID': conid,
                    'EventCriteriaID': input.name,
                    'Score': x

                },
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                processdata: true,
                success: function (result) {
                    console.log("Update complete");
                    
                },
                error: function (msg) {
                    alert('Error Contacting Server, please try again later.');
                }
            });

            
        }
        
  
        
        /*
        things to do in profile

        -mag save ng existing score
          */
        //needed to updated score
        //event criteria ID
        //EvenetJudge ID
        //ContestantID
        //Score
        //event id

        /*
        MCspUpdateScore para sa pag Edit ng score, EventJudgeID,ContestantID,EventCriteriaID,Score
        MCspViewCriteria para sa pag view ng CriteriaName, Weight, EventCriteriaID = EventJudgesID
        MCspViewScore para sa pag view ng actual Score, EventJudgeID,ContestantID, EventCriteriaID
        EventJudgeID,ContestantID,EventCriteriaID,Score
        */
    </script>

</body>
</html>